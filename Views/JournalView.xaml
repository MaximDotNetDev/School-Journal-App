<UserControl x:Class="SchoolJournalApp.Views.JournalView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" 
             d:DesignHeight="850" d:DesignWidth="1000" Background="#E3F2FD">

    <UserControl.Resources>


        <Style x:Key="GradeBtnStyle" TargetType="Button">
            <Setter Property="Width" Value="45"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#CFD8DC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Height" Value="40"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#CFD8DC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#37474F"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Cursor" Value="Hand"/>

            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ComboBoxItem">
                                    <Border x:Name="bd" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" CornerRadius="4" Margin="2,1">
                                        <ContentPresenter VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bd" Property="Background" Value="#E3F2FD"/>
                                            <Setter Property="Foreground" Value="#1565C0"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="bd" Property="Background" Value="#2196F3"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <Border x:Name="MainBorder" Background="{TemplateBinding Background}" CornerRadius="8" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="30"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="{Binding Path=Text, RelativeSource={RelativeSource TemplatedParent}}" 
                                               VerticalAlignment="Center" Margin="12,0,0,0" 
                                               TextTrimming="CharacterEllipsis" IsHitTestVisible="False"/>

                                    <Path Grid.Column="1" Data="M0,0 L5,5 L10,0" Stroke="#78909C" StrokeThickness="2" 
                                          HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False"/>

                                    <ToggleButton Grid.ColumnSpan="2" Background="Transparent" BorderThickness="0" 
                                                  IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border Background="Transparent"/>
                                            </ControlTemplate>
                                        </ToggleButton.Template>
                                    </ToggleButton>
                                </Grid>
                            </Border>

                            <Popup x:Name="PART_Popup" AllowsTransparency="True" IsOpen="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" 
                                   Placement="Bottom" PopupAnimation="Slide" VerticalOffset="2">

                                <Border x:Name="DropDownBorder" Background="White" MaxHeight="250" MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}" 
                                        CornerRadius="8" BorderThickness="1" BorderBrush="#E0E0E0">
                                    <Border.Effect>
                                        <DropShadowEffect Color="#90A4AE" BlurRadius="15" ShadowDepth="5" Opacity="0.2"/>
                                    </Border.Effect>

                                    <ScrollViewer Margin="2">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="MainBorder" Property="BorderBrush" Value="#2196F3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernScrollBarStyle" TargetType="ScrollBar">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Width" Value="10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid x:Name="GridRoot" Width="10" Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="true" Focusable="false">
                                <Track.Thumb>
                                    <Thumb x:Name="Thumb">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border x:Name="ThumbBorder" Background="#CFD8DC" CornerRadius="5" Margin="2"/>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="ThumbBorder" Property="Background" Value="#2196F3"/>
                                                    </Trigger>
                                                    <Trigger Property="IsDragging" Value="True">
                                                        <Setter TargetName="ThumbBorder" Property="Background" Value="#1976D2"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


        <Style x:Key="ScrollThumbStyle" TargetType="{x:Type Thumb}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Thumb}">
                        <Border x:Name="ThumbBorder" CornerRadius="5" Background="#CFD8DC" Margin="2"/>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ThumbBorder" Property="Background" Value="#2196F3"/>
                            </Trigger>
                            <Trigger Property="IsDragging" Value="True">
                                <Setter TargetName="ThumbBorder" Property="Background" Value="#1976D2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernVerticalScrollBarStyle" TargetType="{x:Type ScrollBar}">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                        <Grid x:Name="GridRoot" Width="10" Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="true" Focusable="false">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource ScrollThumbStyle}"/>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


        <Style x:Key="ModernHorizontalScrollBarStyle" TargetType="{x:Type ScrollBar}">
            <Setter Property="Height" Value="10"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                        <Grid x:Name="GridRoot" Height="10" Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="False" Focusable="false">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource ScrollThumbStyle}"/>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


        <Style x:Key="ModernScrollViewer" TargetType="{x:Type ScrollViewer}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollViewer}">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <ScrollContentPresenter Grid.Column="0" Grid.Row="0"/>

                            <ScrollBar x:Name="PART_VerticalScrollBar"
                                       Grid.Column="1" Grid.Row="0"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                       Style="{StaticResource ModernVerticalScrollBarStyle}"/>

                            <ScrollBar x:Name="PART_HorizontalScrollBar"
                                       Grid.Row="1" Grid.Column="0"
                                       Orientation="Horizontal"
                                       Value="{TemplateBinding HorizontalOffset}"
                                       Maximum="{TemplateBinding ScrollableWidth}"
                                       ViewportSize="{TemplateBinding ViewportWidth}"
                                       Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"
                                       Style="{StaticResource ModernHorizontalScrollBarStyle}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </UserControl.Resources>

    <Grid>
        <Border Background="White" CornerRadius="15" Margin="20">
            <Grid Margin="25">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Електронний журнал" FontSize="24" FontWeight="Bold" Foreground="#102A43" Grid.Row="0" Margin="0,0,0,20"/>

                <Border x:Name="TopPanel" Grid.Row="1" Background="White" CornerRadius="12" Padding="15,10" Margin="0,0,0,20" BorderThickness="1" BorderBrush="#F1F5F9">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="20" ShadowDepth="5" Opacity="0.05" Color="#B0BEC5"/>
                    </Border.Effect>

                    <Viewbox Stretch="Uniform" StretchDirection="DownOnly" HorizontalAlignment="Stretch">
                        <Grid MinWidth="850">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,15,0" VerticalAlignment="Center">
                                    <TextBlock Text="🏫 Клас" Foreground="#64748B" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ComboBox x:Name="cmbClasses" Width="75" Style="{StaticResource ModernComboBox}"
                                          DisplayMemberPath="ClassName" SelectedValuePath="ClassID" SelectionChanged="CmbClasses_SelectionChanged"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,0,15,0" VerticalAlignment="Center">
                                    <TextBlock Text="📘 Предмет" Foreground="#64748B" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ComboBox x:Name="cmbSubjects" Width="190" Style="{StaticResource ModernComboBox}"
                                              DisplayMemberPath="SubjectName" SelectedValuePath="SubjectID"/>
                                </StackPanel>

                                <Button Click="BtnLoad_Click" Cursor="Hand">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bd" Background="#2196F3" CornerRadius="6" Padding="15,0" Height="35">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock Text="🔄" Foreground="White" Margin="0,0,8,0" FontSize="14"/>
                                                    <TextBlock Text="Завантажити" Foreground="White" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="bd" Property="Background" Value="#1E88E5"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <Border Background="#FFF8E1" CornerRadius="6" Padding="10,0" Margin="0,0,10,0" BorderBrush="#FFECB3" BorderThickness="1" Height="35">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="📅" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                        <DatePicker x:Name="datePicker" Width="105" BorderThickness="0" Background="Transparent" VerticalContentAlignment="Center"/>
                                    </StackPanel>
                                </Border>

                                <Button Click="BtnAddColumn_Click" Cursor="Hand" Margin="0,0,10,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bdPlus" Background="#4CAF50" CornerRadius="6" Padding="15,0" Height="35">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock Text="➕" Foreground="White" Margin="0,0,5,0" FontSize="12"/>
                                                    <TextBlock Text="Урок" Foreground="White" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="bdPlus" Property="Background" Value="#43A047"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>


                                <Button x:Name="BtnMeet" Click="BtnMeet_Click" MouseRightButtonUp="BtnMeet_MouseRightButtonUp" Cursor="Hand" ToolTip="Перейти до Meet (правий клік для зміни)" Margin="0,0,10,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bdMeet" Background="Orange" CornerRadius="6" Padding="15,0" Height="35">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock Text="📞" Foreground="White" Margin="0,0,5,0" FontSize="14"/>
                                                    <TextBlock Text="Meet" Foreground="White" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="bdMeet" Property="Background" Value="Orange"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>



                            </StackPanel>

                            <Border x:Name="MeetLinkPopup" Grid.RowSpan="99" Width="450" VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed">
                                <Border Background="White" CornerRadius="16" BorderThickness="0">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="40" ShadowDepth="10" Opacity="0.35" Color="#263238"/>
                                    </Border.Effect>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Border Grid.Row="0" Background="#1E88E5" CornerRadius="16,16,0,0" Padding="20">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <TextBlock Text="🔗" FontSize="24" Foreground="White" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                                <TextBlock Text="Налаштування Meet" FontSize="28" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>

                                        <StackPanel Grid.Row="1" Margin="25">
                                            <TextBlock Text="Посилання на Meet:" Foreground="#1565C0" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                                            <Border BorderThickness="1" BorderBrush="#90CAF9" CornerRadius="6" Background="#F5F9FF">
                                                <TextBox x:Name="txtMeetLink" Height="30" Padding="8,5" FontSize="14" BorderThickness="0" Background="Transparent" VerticalContentAlignment="Center"/>
                                            </Border>
                                            <TextBlock Text="Повинно починатися з https://meet.google.com/..." Foreground="#78909C" FontSize="10" Margin="0,5,0,0"/>
                                        </StackPanel>

                                        <Border Grid.Row="2" Background="#F1F5F9" CornerRadius="0,0,16,16" Padding="20">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                                <Button Click="CloseMeetLinkPopup_Click" Cursor="Hand" Margin="0,0,10,0" Content="Скасувати" Foreground="#78909C" FontWeight="SemiBold" Background="Transparent" BorderThickness="0"/>
                                                <Button Click="BtnSaveMeetLink_Click" Cursor="Hand">
                                                    <Button.Template>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border x:Name="bd" Background="#4CAF50" CornerRadius="8" Padding="20,8">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="💾" Foreground="White" Margin="0,0,8,0"/>
                                                                    <TextBlock Text="Зберегти" Foreground="White" FontWeight="Bold"/>
                                                                </StackPanel>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="bd" Property="Background" Value="#43A047"/>
                                                                    <Setter TargetName="bd" Property="Effect">
                                                                        <Setter.Value>
                                                                            <DropShadowEffect BlurRadius="10" Opacity="0.3" ShadowDepth="2"/>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Button.Template>
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </Border>

                        </Grid>
                    </Viewbox>
                </Border>



                <Grid Grid.Row="2">
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition Height="53.306"/>
                        <RowDefinition Height="107.667"/>
                    </Grid.RowDefinitions>

                    <DataGrid x:Name="gridJournal" Grid.Row="0" Margin="0,0,0,10" MinHeight="250"
                      AutoGenerateColumns="True" 
                      CanUserAddRows="False" 
                      CanUserResizeColumns="False" 
                      CanUserReorderColumns="False"
                      CanUserSortColumns="False"
                      FrozenColumnCount="3" 
                      HeadersVisibility="Column" 
                      Background="White"
                      BorderThickness="0"
                      IsReadOnly="True"
                      SelectionUnit="Cell"
                      SelectionMode="Single"
                      GridLinesVisibility="All"
                      HorizontalGridLinesBrush="#E3F2FD" 
                      VerticalGridLinesBrush="#E3F2FD"
                      AlternationCount="2" 
                      RowHeight="25" 
                      
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      ScrollViewer.CanContentScroll="True"
                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                      ScrollViewer.HorizontalScrollBarVisibility="Auto"

                      PreviewMouseLeftButtonUp="GridJournal_PreviewMouseLeftButtonUp"
                      AutoGeneratingColumn="GridJournal_AutoGeneratingColumn">

                        <DataGrid.Resources>
                            <Style TargetType="{x:Type ScrollBar}">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type ScrollBar}">
                                            <Grid x:Name="Root">
                                                <Track x:Name="PART_Track" IsDirectionReversed="true" Focusable="false">
                                                    <Track.Thumb>
                                                        <Thumb>
                                                            <Thumb.Template>
                                                                <ControlTemplate TargetType="{x:Type Thumb}">
                                                                    <Border x:Name="ThumbBorder" Background="#CFD8DC" CornerRadius="4" Margin="2"/>
                                                                    <ControlTemplate.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter TargetName="ThumbBorder" Property="Background" Value="#2196F3"/>
                                                                        </Trigger>
                                                                        <Trigger Property="IsDragging" Value="True">
                                                                            <Setter TargetName="ThumbBorder" Property="Background" Value="#1976D2"/>
                                                                        </Trigger>
                                                                    </ControlTemplate.Triggers>
                                                                </ControlTemplate>
                                                            </Thumb.Template>
                                                        </Thumb>
                                                    </Track.Thumb>
                                                </Track>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="Orientation" Value="Vertical">
                                                    <Setter TargetName="Root" Property="Width" Value="10"/>
                                                    <Setter TargetName="PART_Track" Property="IsDirectionReversed" Value="true"/>
                                                </Trigger>
                                                <Trigger Property="Orientation" Value="Horizontal">
                                                    <Setter TargetName="Root" Property="Height" Value="10"/>
                                                    <Setter TargetName="PART_Track" Property="IsDirectionReversed" Value="False"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGrid.Resources>

                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                                        <Setter Property="Background" Value="#F8FBFF"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#E6F4FF"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="BorderBrush" Value="Transparent"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>

                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="TextBlock.TextAlignment" Value="Center"/>
                                <Setter Property="VerticalContentAlignment" Value="Center"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#2196F3"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.CellStyle>

                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Height" Value="45"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="FontSize" Value="12"/>
                                <Setter Property="Background" Value="#E1F5FE"/>
                                <Setter Property="BorderBrush" Value="#B3E5FC"/>
                                <Setter Property="BorderThickness" Value="0,0,1,1"/>
                                <Setter Property="Padding" Value="5,0"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="ToolTip" Value="Натисніть для налаштування уроку"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>
                    </DataGrid>

                    <Grid Grid.Row="1" Margin="0,5,0,0" Grid.RowSpan="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Теми уроків та домашні завдання" FontSize="20" FontWeight="Bold" Foreground="#102A43" VerticalAlignment="Center"/>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Click="BtnImportPlan_Click" Cursor="Hand" ToolTip="Імпорт тем з Excel" Margin="0,0,10,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bdImp" Background="#2E7D32" CornerRadius="6" Padding="15,0" Height="30">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock Text="📥" Foreground="White" Margin="0,0,5,0"/>
                                                    <TextBlock Text="Імпорт (Excel)" Foreground="White" FontWeight="Bold" FontSize="12"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="bdImp" Property="Background" Value="#1B5E20"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>

                                <Button Click="BtnExportTopics_Click" Cursor="Hand" ToolTip="Експорт тем у Excel" Margin="0,0,10,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bdExp" Background="#1565C0" CornerRadius="6" Padding="15,0" Height="30">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock Text="📤" Foreground="White" Margin="0,0,5,0"/>
                                                    <TextBlock Text="Експорт (Excel)" Foreground="White" FontWeight="Bold" FontSize="12"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="bdExp" Property="Background" Value="#0D47A1"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>

                                <Button Click="BtnExportJournalPDF_Click" Cursor="Hand" ToolTip="Зберегти журнал у PDF">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bdPdf" Background="#F44336" CornerRadius="6" Padding="15,0" Height="30">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock Text="📄" Foreground="White" Margin="0,0,5,0"/>
                                                    <TextBlock Text="PDF" Foreground="White" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="bdPdf" Property="Background" Value="#D32F2F"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </StackPanel>
                        </Grid>

                        <DataGrid x:Name="gridTopics" Grid.Row="1" Margin="0,0,0,10" Height="135"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False" CanUserDeleteRows="False"
                          IsReadOnly="True" HeadersVisibility="Column"
                          Background="White" BorderThickness="0"
                          GridLinesVisibility="All" 
                          HorizontalGridLinesBrush="#E3F2FD" 
                          VerticalGridLinesBrush="#E3F2FD"
                          AlternationCount="2" 
                          RowHeight="30"
                          VerticalScrollBarVisibility="Auto">

                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Style.Triggers>
                                        <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                                            <Setter Property="Background" Value="#F8FBFF"/>
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#E6F4FF"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Дата" Binding="{Binding Date}" Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="VerticalAlignment" Value="Center"/>
                                            <Setter Property="Padding" Value="5"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <DataGridTextColumn Header="№" Binding="{Binding LessonNumber}" Width="50">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="VerticalAlignment" Value="Center"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <DataGridTextColumn Header="Тема уроку" Binding="{Binding Topic}" Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextWrapping" Value="Wrap"/>
                                            <Setter Property="Padding" Value="5"/>
                                            <Setter Property="VerticalAlignment" Value="Center"/>
                                            <Setter Property="HorizontalAlignment" Value="Left"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <DataGridTextColumn Header="Домашнє завдання" Binding="{Binding Homework}" Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextWrapping" Value="Wrap"/>
                                            <Setter Property="Padding" Value="5"/>
                                            <Setter Property="VerticalAlignment" Value="Center"/>
                                            <Setter Property="HorizontalAlignment" Value="Left"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>

                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Height" Value="35"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="Background" Value="#E1F5FE"/>
                                    <Setter Property="BorderBrush" Value="#B3E5FC"/>
                                    <Setter Property="BorderThickness" Value="0,0,1,1"/>
                                    <Setter Property="Padding" Value="5,0"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                        </DataGrid>

                        <TextBlock Grid.Row="2" Text="* Клікніть на клітинку в журналі для оцінки | Клікніть на дату для редагування теми" 
                           Foreground="#90A4AE" FontStyle="Italic" HorizontalAlignment="Right" FontSize="11" Margin="0,0,0,20"/>
                    </Grid>
                </Grid>
            </Grid>
        </Border>

        <Border x:Name="UIBlocker" Grid.RowSpan="99" Background="#44000000" Visibility="Collapsed" MouseDown="UIBlocker_MouseDown"/>

        <Popup x:Name="GradePopup" StaysOpen="True" Placement="MousePoint" AllowsTransparency="True">
            <Border Background="White" CornerRadius="8" BorderThickness="2" BorderBrush="#2196F3" Padding="10">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="5" Opacity="0.4"/>
                </Border.Effect>

                <UniformGrid Columns="5" Rows="5">
                    <Button Content="1" Foreground="Red" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="2" Foreground="Red" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="3" Foreground="Orange" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="4" Foreground="Orange" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="5" Foreground="Orange" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>

                    <Button Content="6" Foreground="#FBC02D" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="7" Foreground="#FBC02D" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="8" Foreground="#AFB42B" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="9" Foreground="#AFB42B" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="10" Foreground="Green" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>

                    <Button Content="11" Foreground="Green" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="12" Foreground="#2E7D32" FontWeight="ExtraBold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="Н" ToolTip="Немає (Відсутній)" Foreground="#1565C0" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="хв" ToolTip="Хворів" Foreground="#1565C0" FontSize="12" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="п/п" ToolTip="Поважна причина" Foreground="#1565C0" FontSize="11" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>

                    <Button Content="В" ToolTip="Високий рівень" Foreground="#2E7D32" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="Д" ToolTip="Достатній рівень" Foreground="#4CAF50" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="С" ToolTip="Середній рівень" Foreground="#FBC02D" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="П" ToolTip="Початковий рівень" Foreground="Red" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>

                    <Button Content="Н/А" ToolTip="Не атестований" Foreground="#D32F2F" FontSize="11" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>

                    <Button Content="Н/О" ToolTip="Немає оцінки" Foreground="#78909C" FontSize="11" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>
                    <Button Content="Зар" ToolTip="Зараховано" Foreground="Green" FontSize="11" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Click"/>

                    <Button Visibility="Hidden"/>
                    <Button Visibility="Hidden"/>

                    <Button Content="X" ToolTip="Очистити клітинку" Foreground="Red" FontWeight="Bold" Style="{StaticResource GradeBtnStyle}" Click="GradeButton_Clear_Click"/>
                </UniformGrid>
            </Border>
        </Popup>

        <Border x:Name="LessonInfoPopup" Grid.RowSpan="99" Width="450" VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed">
            <Border Background="White" CornerRadius="16" BorderThickness="0">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="40" ShadowDepth="10" Opacity="0.35" Color="#263238"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Border Grid.Row="0" Background="#1976D2" CornerRadius="16,16,0,0" Padding="20">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="📅" FontSize="24" Foreground="White" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <TextBlock x:Name="txtLessonDate" Text="21.11" FontSize="28" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    <StackPanel Grid.Row="1" Margin="25">
                        <TextBlock Text="Тип уроку (Стандартний):" Foreground="#455A64" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                        <ComboBox x:Name="cmbStandardType" 
          Height="40" 
          Margin="0,0,0,15" 
          Style="{StaticResource ModernComboBox}" 
          SelectionChanged="CmbStandardType_SelectionChanged"/>

                        <Border Height="1" Background="#E0E0E0" Margin="0,0,0,15"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="Група результатів (НУШ):" Foreground="#00695C" FontWeight="Bold" FontSize="14"/>
                            <TextBlock x:Name="txtBranchName" Text="(Галузь не визначено)" Foreground="#00897B" FontStyle="Italic" Margin="10,0,0,0" VerticalAlignment="Center" FontSize="11"/>
                        </StackPanel>

                        <ComboBox x:Name="cmbNushType" 
          Height="40" 
          Margin="0,0,0,15" 
          Style="{StaticResource ModernComboBox}" 
          SelectionChanged="CmbNushType_SelectionChanged">
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="ContentTemplate">
                                        <Setter.Value>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}" TextWrapping="Wrap" MaxWidth="350" Padding="5"/>
                                            </DataTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ComboBox.ItemContainerStyle>
                        </ComboBox>
                        <TextBlock Text="Тема уроку:" Foreground="#1565C0" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                        <Border BorderThickness="1" BorderBrush="#90CAF9" CornerRadius="6" Background="#F5F9FF">
                            <TextBox x:Name="txtLessonTopic" Height="60" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Padding="8" FontSize="14" BorderThickness="0" Background="Transparent"/>
                        </Border>
                        <TextBlock Text="Домашнє завдання:" Foreground="#E65100" FontWeight="Bold" FontSize="14" Margin="0,15,0,8"/>
                        <Border BorderThickness="1" BorderBrush="#FFCC80" CornerRadius="6" Background="#FFF8E1">
                            <TextBox x:Name="txtLessonHW" Height="60" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Padding="8" FontSize="14" BorderThickness="0" Background="Transparent"/>
                        </Border>
                    </StackPanel>
                    <Border Grid.Row="2" Background="#F1F5F9" CornerRadius="0,0,16,16" Padding="20">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0" Click="BtnDeleteLesson_Click" Cursor="Hand" ToolTip="Видалити цей урок">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bd" Background="#FFEBEE" CornerRadius="8" Padding="15,8" BorderBrush="#FFCDD2" BorderThickness="1">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="🗑" Foreground="#D32F2F" Margin="0,0,5,0"/>
                                                <TextBlock Text="Видалити" Foreground="#D32F2F" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="bd" Property="Background" Value="#FFCDD2"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <Button Click="CloseLessonInfo_Click" Cursor="Hand" Margin="0,0,10,0" Content="Скасувати" Foreground="#78909C" FontWeight="SemiBold" Background="Transparent" BorderThickness="0">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="Transparent" Padding="10,5">
                                                            <ContentPresenter/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Foreground" Value="#455A64"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <Button Click="BtnSaveLesson_Click" Cursor="Hand">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bd" Background="#4CAF50" CornerRadius="8" Padding="20,8">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="💾" Foreground="White" Margin="0,0,8,0"/>
                                                    <TextBlock Text="Зберегти" Foreground="White" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="bd" Property="Background" Value="#43A047"/>
                                                    <Setter TargetName="bd" Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect BlurRadius="10" Opacity="0.3" ShadowDepth="2"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Border>
    </Grid>
</UserControl>